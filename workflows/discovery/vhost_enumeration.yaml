id: vhost_enumeration
description: Virtual host discovery using certificate transparency and passive enumeration
parallel: true
continue_on_error: true
execution:
  timeout_seconds: 600  # 10 minutes for comprehensive discovery
  max_concurrent_steps: 3
  retry_count: 2
  failure_strategy: "continue"
steps:
  - id: passive_subdomain_enum
    tool: subfinder
    use_flags: fast_scan
    override_args:
      - "-d"
      - "{{target}}"
    output: "out/{{target}}/subdomains_passive.json"
    
  - id: comprehensive_subdomain_enum
    tool: subfinder  
    use_flags: comprehensive
    override_args:
      - "-d"
      - "{{target}}"
    output: "out/{{target}}/subdomains_comprehensive.json"
    optional: true
    
  - id: ct_only_enum
    tool: subfinder
    use_flags: ct_only
    override_args:
      - "-d"
      - "{{target}}"
    output: "out/{{target}}/subdomains_ct.json"
    
  - id: merge_subdomains
    type: merge_files
    inputs:
      - "out/{{target}}/subdomains_passive.json"
      - "out/{{target}}/subdomains_ct.json" 
      - "out/{{target}}/subdomains_comprehensive.json"
    output: "out/{{target}}/all_subdomains.json"
    depends_on: [passive_subdomain_enum, ct_only_enum]
    
  - id: extract_hostnames
    type: json_to_hostlist
    inputs:
      - "out/{{target}}/all_subdomains.json"
    output: "out/{{target}}/discovered_hosts.txt"
    depends_on: [merge_subdomains]