id: portscan_fingerprint
description: Fast port scan + fingerprinting using naabu and nmap
parallel: true
steps:
  - id: scan_fast
    tool: naabu
    use_flags: fast
    override_args:
      - "{{target}}"
    output: "out/{{target}}/naabu_fast.json"
    
  - id: scan_full
    tool: naabu
    use_flags: full
    override_args:
      - "{{target}}"
    output: "out/{{target}}/naabu_full.json"
    
  - id: merge_ports
    type: merge_files
    inputs:
      - "out/{{target}}/naabu_fast.json"
      - "out/{{target}}/naabu_full.json"
    output: "out/{{target}}/merged_ports.json"
    depends_on: [scan_fast, scan_full]
    
  - id: convert_to_hostlist
    type: json_to_hostlist
    inputs:
      - "out/{{target}}/merged_ports.json"
    output: "out/{{target}}/hostlist.txt"
    depends_on: [merge_ports]
    
  - id: fingerprint
    tool: nmap
    use_flags: comprehensive
    override_args:
      - "-iL"
      - "{{convert_to_hostlist.output}}"
      - "-oX"
      - "out/{{target}}/nmap_fingerprint.xml"
    output: "out/{{target}}/nmap_fingerprint.xml"
    depends_on: [convert_to_hostlist]