name: "Port Discovery Scan"
description: "Fast port discovery scan to identify open ports using naabu"
provides:
  - "discovered_ports"
report:
  enabled: true
  agents:
    - receiver
    - universal_processor
    - validator
    - reporter
  coordination: true
steps:
  - tool: "naabu"
    args_sudo:
      - "-host"            # Target host
      - "{{target}}"       # Target to scan
      - "-top-ports"       # Use top ports for speed (much faster than -p -)
      - "1000"             # Scan top 1000 most common ports
      - "-rate"            # Packets per second
      - "10000"            # Higher rate with sudo for faster scanning
      - "-c"               # Worker threads
      - "100"              # Higher concurrency with sudo
      - "-timeout"         # Timeout per probe
      - "300"              # Faster timeout for quicker dead port detection
      - "-retries"         # Number of retries
      - "1"                # Minimal retries for speed
      - "-silent"          # Clean output
      - "-json"            # JSON output format
      - "-o"               # Output file
      - "{{report_dir}}/raw/naabu_port_discovery_{{target}}.json"
    args_normal:
      - "-host"            # Target host
      - "{{target}}"       # Target to scan
      - "-top-ports"       # Use top ports mode for speed
      - "1000"             # Scan top 1000 most common ports (same as sudo for consistency)
      - "-rate"            # Packets per second
      - "5000"             # Increased rate for faster scanning
      - "-c"               # Worker threads
      - "50"               # Balanced concurrency
      - "-timeout"         # Timeout per probe
      - "500"              # Faster timeout than before but not as aggressive as sudo
      - "-retries"         # Number of retries
      - "1"                # Minimal retries for speed
      - "-silent"          # Clean output
      - "-json"            # JSON output format
      - "-o"               # Output file
      - "{{report_dir}}/raw/naabu_port_discovery_{{target}}.json"