name: "Deep Service Analysis"
description: "Detailed service and version detection on discovered open ports"
requires:
  - "port-discovery"
report:
  enabled: true
  agents:
    - receiver
    - nmap_processor
    - validator
    - reporter
steps:
  - tool: "nmap"
    args:
      - "-sT"              # TCP connect scan (no root required)
      - "-sV"              # Version detection
      - "-sC"              # Default scripts
      - "-Pn"              # Treat all hosts as online
      - "-T3"              # Normal timing (more reliable for deep scan)
      - "-p"               # Port specification
      - "{{discovered_ports}}"  # Ports from port-discovery workflow
      - "-oX"              # XML output for parsing
      - "{{report_dir}}/raw/nmap_deep_scan_{{target}}.xml"
      - "{{target}}"       # Target to scan