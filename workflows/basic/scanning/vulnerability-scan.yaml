name: "Offensive Security Vulnerability Scan"
description: "Penetration testing focused scan to find exploitable CVEs, exposed panels, misconfigurations, and default credentials"
parallel_group: "analysis"
requires:
  - "port-discovery"
report:
  enabled: true
  agents:
    - receiver
    - universal_processor
    - validator
    - reporter
steps:
  - tool: "nuclei"
    args_sudo:
      - "-u"                    # Target URL
      - "{{target_urls}}"       # Converted from discovered_ports to URLs
      - "-t"                    # Templates to use (offensive security focused)
      - "database/nuclei-templates/http/,database/nuclei-templates/file/"
      - "-j"                    # JSON output format
      - "-o"                    # Output file
      - "{{report_dir}}/raw/nuclei_vulnerability_scan_{{target}}.json"
      - "-stats"                # Show statistics
      - "-silent"               # Reduce output noise
      - "-rate-limit"           # Requests per second
      - "200"                   # Higher rate with sudo
      - "-c"                    # Concurrent templates
      - "25"                    # Higher concurrency with sudo
      - "-timeout"              # Request timeout
      - "15"                    # Longer timeout for comprehensive checks
      - "-retries"              # Retry attempts
      - "3"                     # More retries for thorough scanning
      - "-include-tags"         # Include high-value offensive security targets
      - "cve,rce,sqli,lfi,rfi,ssrf,auth-bypass,default-login,panel,admin,login,exposed,misconfig,file-upload"
    args_normal:
      - "-u"                    # Target URL
      - "{{target_urls}}"       # Converted from discovered_ports to URLs
      - "-t"                    # Templates to use (offensive security focused)
      - "database/nuclei-templates/http/,database/nuclei-templates/file/"
      - "-j"                    # JSON output format
      - "-o"                    # Output file
      - "{{report_dir}}/raw/nuclei_vulnerability_scan_{{target}}.json"
      - "-stats"                # Show statistics
      - "-silent"               # Reduce output noise
      - "-rate-limit"           # Requests per second
      - "150"                   # Conservative rate limiting
      - "-c"                    # Concurrent templates
      - "15"                    # Balanced concurrency
      - "-timeout"              # Request timeout
      - "10"                    # 10 second timeout
      - "-retries"              # Retry attempts
      - "2"                     # 2 retries for failed requests
      - "-include-tags"         # Include key offensive security categories  
      - "cve,rce,sqli,lfi,auth-bypass,default-login,panel,admin,login,exposed,misconfig,file-upload"
      - "-exclude-tags"         # Exclude resource-intensive and low-value templates
      - "dos,fuzz,info,detect,tech,generic,token-spray"