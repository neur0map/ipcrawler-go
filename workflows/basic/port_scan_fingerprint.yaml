id: port_scan_fingerprint
description: Complete port scanning and service fingerprinting pipeline
parallel: true
continue_on_error: true
steps:
  - id: scan_low1k
    tool: naabu
    use_flags: low1kcommon
    override_args:
      - "{{target}}"
    output: "out/{{target}}/naabu_low1kcommon.json"
    
  - id: scan_high1k
    tool: naabu
    use_flags: high1kcommon
  
    override_args:
      - "{{target}}"
    output: "out/{{target}}/naabu_high1kcommon.json"
    
  - id: merge_ports
    type: merge_files
    inputs:
      - "out/{{target}}/naabu_low1kcommon.json"
      - "out/{{target}}/naabu_high1kcommon.json"
    output: "out/{{target}}/merged_ports.json"
    depends_on: [scan_low1k, scan_high1k]
    
  - id: convert_to_hostlist
    type: json_to_hostlist
    inputs:
      - "out/{{target}}/merged_ports.json"
    output: "out/{{target}}/hostlist.txt"
    depends_on: [merge_ports]
    
  - id: fingerprint
    tool: nmap
    use_flags: fingerprint
    override_args:
      - "-p"
      - "{{@file:out/{{target}}/ports.txt}}"
      - "{{target}}"
    output: "out/{{target}}/nmap_fingerprint.txt"
    optional: true
    depends_on: [convert_to_hostlist]